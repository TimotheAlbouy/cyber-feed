<!DOCTYPE html>
<html lang="fr">
  <head>
    <title>Flux</title>
    <meta charset="UTF-8"/>
    <script src="util.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  </head>

  <body>
    <div>
      <h3>Mes flux</h3>
      
      <ul id="feeds" class="collection"></ul>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
      refreshFeeds();
    });

    function refreshFeeds() {
      const token = getToken();
      const headers = {
        "Authorization": token,
      };
      apiRequest("GET", "get_feeds_content.php", null, headers, res => {
        const jsonRes = JSON.parse(res.responseText);
        const feeds = document.getElementById("feeds");
        const template = document.getElementById("feed-item");
        for (const feed of jsonRes.feeds) {
          const feedItem = document.importNode(template.content, true);
          
          const image = feedItem.querySelector("img");
          image.src = feed.imageUrl;
          image.type = feed.imageType;

          const title = feedItem.querySelector("span");
          title.innerText = feed.title;

          const description = feedItem.querySelector("p");
          description.innerText = feed.description;

          feeds.appendChild(feedItem);
        }
      }, err => {
        //
      });
    }
    </script>

    <template id="feed-item">
      <li>
        <img src="collection-item avatar" alt="Image introuvable" />
        <span class="title"></span>
        <p></p>
      </li>
    </template>

  </body>
</html>